#!/bin/sh

# Start a composite manager.

usage() {
    echo "Usage: $(basename $0) [-x] [-t] [-s]"
}

stopcomp() {
    pgrep "picom" && killall picom
    pgrep "xcompmgr" && killall xcompmgr
}

toggle() {
    comp=`expr 1 - $comp`
    notify=true
}

startcomp() {
    stopcomp
    if [ $comp -eq 0 ]
    then
        picom -b --config ~/.config/picom/picom.conf
        $notify && notify-send "Compositor" "Switched to picom."
    else
        xcompmgr -CcfF -I0.03 -O0.03 -D4 &
        $notify && notify-send "Compositor" "Switched to xcompmgr."
    fi
}

pgrep "xcompmgr" && comp=1 || comp=0
notify=false

case "$1" in
    "")   startcomp ;;
    "-x") startcomp ;;
    "-t") toggle; startcomp ;;
    "-s") stopcomp ;;
    "-h") usage ;;
    *)    usage; exit 1 ;;
esac
